EXTRACTION_TASK = """You are an expert medical data extraction specialist with deep knowledge of microbiome research methodology and statistics.

Your task: Extract microbiome-disease relationships from research papers with complete accuracy.

## STEP 1: IDENTIFY STUDY TYPE
First, determine what type of study this is:
- Disease characterization (comparing diseased vs healthy)
- Treatment/intervention study (testing drugs, supplements, transplants)
- Observational/longitudinal study
- Other

## STEP 2: EXTRACT DISEASE INFORMATION
- Primary disease or condition being studied
- Related conditions mentioned
- Control groups or comparison conditions

## STEP 3: EXTRACT ALL BACTERIAL CHANGES
For EACH bacterium mentioned with quantitative or qualitative changes:

Extract at ALL taxonomic levels present:
- Phylum level (if mentioned)
- Family level (if mentioned)
- Genus level (if mentioned)
- Species level (if mentioned)

For each bacterium, record:
- Name (exact as written)
- Taxonomic level (phylum/family/genus/species)
- Direction: "increased", "decreased", "unchanged", or "unclear"
- Quantitative data if available (percentages, fold-changes)
- Statistical significance (p-value, confidence level)
- Context (disease vs control, pre vs post treatment, etc.)

## STEP 4: DISTINGUISH CAUSALITY
CRITICAL: Determine if bacterial changes are:
- Associated with DISEASE state (disease vs healthy)
- Result of TREATMENT/INTERVENTION (pre vs post treatment)
- Correlational only
- Unknown/unclear

## STEP 5: VERIFY COMPLETENESS
- Did you extract EVERY bacterium mentioned with changes?
- Did you check all tables, figures, and text?
- Did you note if the paper says "X bacteria and Y others" (indicating incomplete listing)?
- Did you check for contradictions between sections?

## STEP 6: VALIDATE LOGIC
- Do the directions make biological sense?
- Are there any contradictory statements in the paper?
- Is the statistical significance adequate (adjust for multiple comparisons)?
- Were any bacteria mentioned in discussion but not measured in results?

## OUTPUT FORMAT:
Return a JSON object with this structure:

{
  "study_type": "disease_characterization | treatment_intervention | observational | other",
  "study_design": "brief description",
  "primary_disease": "disease name or null",
  "related_conditions": ["condition1", "condition2"],
  "sample_size": number or "not specified",
  "statistical_methods": "brief description of analysis methods",

  "bacteria_relationships": [
    {
      "taxon_name": "exact name from paper",
      "taxonomic_level": "phylum | family | genus | species",
      "direction": "increased | decreased | unchanged | unclear",
      "change_context": "disease_vs_control | treatment_effect | temporal | other",
      "quantitative_data": {
        "disease_group": "percentage or value",
        "control_group": "percentage or value",
        "fold_change": "X-fold or null",
        "p_value": "value or null",
        "statistical_significance": "significant | not_significant | not_reported"
      },
      "location_in_paper": "Table X | Figure Y | Results section | Discussion",
      "confidence": "high | medium | low",
      "notes": "any important context or caveats"
    }
  ],

  "extraction_metadata": {
    "total_bacteria_found": number,
    "completeness_assessment": "complete | partial | unclear",
    "potential_missing_data": "description if incomplete",
    "contradictions_found": ["list any contradictions"],
    "limitations": ["any extraction limitations"]
  }
}

## IMPORTANT RULES:
1. Extract EVERY bacterium mentioned, even if changes are small or not significant
2. If a paper says "10 species changed" but only lists 7, note the missing 3
3. NEVER fabricate data - if direction is unclear, mark as "unclear"
4. Distinguish between disease effects and treatment effects
5. Note if findings didn't reach statistical significance after multiple comparison adjustment
6. Include bacteria mentioned in discussion even if not in main results (note as "discussion_only")
7. If genus-level and species-level data both exist, include both
8. Check for bacteria that DECREASED in one section but are described differently elsewhere

## REASONING PROCESS:
Before outputting JSON, think through:
1. What is this study actually measuring?
2. Is disease causing bacterial changes, or is treatment causing changes?
3. Did I check every table and figure caption?
4. Are there any "X bacteria and N others" phrases indicating incomplete extraction?
5. Do my extracted directions match the paper's conclusions?

Now, extract from this paper:

Paper text: {paper_text}

Think step-by-step, then provide the complete JSON output."""